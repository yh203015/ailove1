<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»™ä½ çš„å°æƒŠå–œ Â· æœ¬åœ°éŸ³ä¹ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(to bottom, #0a0e27, #1a1a2e);
            font-family: "Microsoft Yahei", sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        /* çƒŸèŠ±ä¸Šå‡è½¨è¿¹ */
        .trail {
            position: absolute;
            width: 2px;
            height: 0;
            background: linear-gradient(to top, transparent, #fff);
            transform-origin: bottom center;
            animation: trail-rise 1.5s ease-out forwards;
        }
        @keyframes trail-rise {
            to {
                height: 70vh;
                opacity: 0;
            }
        }
        /* çƒŸèŠ±çˆ†ç‚¸ç²’å­ */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            opacity: 0;
            animation: particle-explode 1.5s ease-out forwards;
        }
        @keyframes particle-explode {
            0% {
                opacity: 1;
                transform: translate(0, 0);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty));
            }
        }
        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
            width: 100%;
            max-width: 300px;
        }
        .file-btn, .start-btn {
            border: none;
            padding: 18px 20px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(255, 94, 151, 0.4);
            transition: 0.3s;
            color: white;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .file-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }
        .start-btn {
            background: linear-gradient(135deg, #ff5e97, #ff9a8b);
        }
        .file-btn:hover, .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 25px rgba(255, 94, 151, 0.5);
        }
        .file-btn:disabled, .start-btn:disabled {
            opacity: 0.6;
            transform: none;
            cursor: default;
        }
        /* æ–‡å­—æ°”æ³¡ */
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 18px;
            color: #2d2d2d;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            opacity: 0;
            animation: bubble-float 2s ease-out forwards;
            white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(5px);
            pointer-events: none;
        }
        @keyframes bubble-float {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(1);
            }
        }
        /* æç¤º */
        .hint {
            color: rgba(255,255,255,0.5);
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }
        /* éšè—çš„æ–‡ä»¶è¾“å…¥ */
        #fileInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="btn-group">
        <!-- è‡ªå®šä¹‰æ–‡ä»¶é€‰æ‹©æŒ‰é’® -->
        <button class="file-btn" id="fileBtn">ğŸµ é€‰æ‹©éŸ³ä¹æ–‡ä»¶</button>
        <button class="start-btn" id="startBtn" disabled>ğŸ’Œ ç‚¹æˆ‘ï¼Œæœ‰æƒŠå–œ</button>
        <div class="hint">âœ¨ å…ˆç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é€‰æ‹©ä½ ä¸‹è½½çš„MP3</div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´ ï¼ˆèƒŒæ™¯éŸ³ä¹ + çˆ†ç‚¸éŸ³æ•ˆï¼‰ -->
    <audio id="bgMusic" loop preload="auto"></audio>
    <audio id="boomSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-firework-explosion-2759.mp3" type="audio/mpeg">
    </audio>

    <script>
        (function() {
            const fileBtn = document.getElementById('fileBtn');
            const startBtn = document.getElementById('startBtn');
            const fileInput = document.createElement('input'); // åŠ¨æ€åˆ›å»ºæ–‡ä»¶è¾“å…¥
            fileInput.type = 'file';
            fileInput.accept = 'audio/*'; // åªå…è®¸é€‰æ‹©éŸ³é¢‘æ–‡ä»¶
            fileInput.id = 'fileInput';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);

            const bgMusic = document.getElementById('bgMusic');
            const boomSound = document.getElementById('boomSound');
            
            const colors = ['#ff5e97', '#ffd700', '#00ffff', '#ff6347', '#32cd32', '#ff69b4', '#ff4500', '#9400d3'];
            const messages = [
                "å…¶å®æˆ‘å–œæ¬¢ä½ å¾ˆä¹…äº†ã€‚",
                "ä¸æ˜¯ä¸€æ—¶å…´èµ·ï¼Œæ˜¯è®¤çœŸçš„ã€æ…¢æ…¢çš„ã€è¶Šæ¥è¶Šæ·±çš„å–œæ¬¢ã€‚",
                "æˆ‘å–œæ¬¢çœ‹ä½ ç¬‘ï¼Œå–œæ¬¢å¬ä½ è¯´è¯ï¼Œå–œæ¬¢å’Œä½ å¾…åœ¨ä¸€èµ·çš„æ¯ä¸€ç§’ã€‚"
            ];

            let musicSelected = false;      // æ˜¯å¦å·²é€‰æ‹©éŸ³ä¹
            let musicUrl = null;            // å­˜å‚¨ä¸´æ—¶URLï¼Œç”¨äºé‡Šæ”¾

            // ç‚¹å‡»â€œé€‰æ‹©éŸ³ä¹æ–‡ä»¶â€æŒ‰é’®ï¼Œè§¦å‘éšè—çš„æ–‡ä»¶é€‰æ‹©
            fileBtn.addEventListener('click', function() {
                fileInput.click();
            });

            // å½“ç”¨æˆ·é€‰æ‹©äº†æ–‡ä»¶
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                // æ£€æŸ¥æ˜¯å¦æ˜¯éŸ³é¢‘
                if (!file.type.startsWith('audio/')) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼ˆå¦‚MP3ï¼‰');
                    return;
                }

                // é‡Šæ”¾ä¹‹å‰é€‰æ‹©çš„æ–‡ä»¶URLï¼ˆå¦‚æœæœ‰ï¼‰
                if (musicUrl) {
                    URL.revokeObjectURL(musicUrl);
                }

                // åˆ›å»ºæ–°çš„å¯¹è±¡URL
                musicUrl = URL.createObjectURL(file);
                
                // è®¾ç½®èƒŒæ™¯éŸ³ä¹æº
                bgMusic.src = musicUrl;
                
                // æ ‡è®°å·²é€‰æ‹©
                musicSelected = true;
                fileBtn.textContent = `âœ… å·²é€‰æ‹©ï¼š${file.name.substring(0, 12)}...`; // æ˜¾ç¤ºæ–‡ä»¶åå‰12ä¸ªå­—ç¬¦
                fileBtn.disabled = true;     // ç¦æ­¢å†æ¬¡é€‰æ‹©ï¼ˆå¯é€‰ï¼Œä½ å¯ä»¥æ”¾å¼€ï¼‰
                startBtn.disabled = false;    // å¯ç”¨æƒŠå–œæŒ‰é’®

                // å¯é€‰ï¼šé¢„åŠ è½½éŸ³ä¹
                bgMusic.load();
                
                // æç¤ºç”¨æˆ·
                document.querySelector('.hint').textContent = 'ğŸ‰ éŸ³ä¹å·²å°±ç»ªï¼Œç‚¹å‡»â€œç‚¹æˆ‘â€å¼€å§‹ï¼';
            });

            // ç‚¹å‡»â€œç‚¹æˆ‘â€æŒ‰é’®
            startBtn.addEventListener('click', function() {
                if (!musicSelected) {
                    alert('è¯·å…ˆé€‰æ‹©éŸ³ä¹æ–‡ä»¶');
                    return;
                }

                // éšè—æŒ‰é’®
                fileBtn.style.display = 'none';
                startBtn.style.display = 'none';
                document.querySelector('.hint').style.display = 'none';

                // æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆå¿…é¡»ç”±ç”¨æˆ·æ‰‹åŠ¿è§¦å‘ï¼‰
                bgMusic.play().catch(err => {
                    console.warn('éŸ³ä¹æ’­æ”¾å¤±è´¥', err);
                    alert('éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });

                // ç”Ÿæˆæ–‡å­—æ°”æ³¡
                createBubbles();

                // ç«‹å³å‘å°„ç¬¬ä¸€æšçƒŸèŠ±
                launchFirework();

                // æ¯éš”3ç§’å‘å°„ä¸€æšçƒŸèŠ±
                setInterval(() => {
                    launchFirework();
                }, 3000);
            });

            // å‘å°„çƒŸèŠ±ï¼ˆä¸ä¹‹å‰ç›¸åŒï¼‰
            function launchFirework() {
                const startX = Math.random() > 0.5 ? 60 : window.innerWidth - 60;
                const startY = window.innerHeight - 30;
                const explodeX = startX + (Math.random() - 0.5) * 500;
                const explodeY = window.innerHeight * 0.2 + Math.random() * 150;

                const trail = document.createElement('div');
                trail.classList.add('trail');
                trail.style.left = startX + 'px';
                trail.style.bottom = '30px';
                trail.style.height = '0';
                document.body.appendChild(trail);

                setTimeout(() => {
                    if (trail.parentNode) trail.remove();
                    explode(explodeX, explodeY);
                    
                    // æ’­æ”¾çˆ†ç‚¸éŸ³æ•ˆï¼ˆä½¿ç”¨ç½‘ç»œé“¾æ¥ï¼‰
                    const boomClone = boomSound.cloneNode(true);
                    boomClone.volume = 0.6;
                    boomClone.play().catch(err => {
                        // é™çº§
                        boomSound.currentTime = 0;
                        boomSound.volume = 0.6;
                        boomSound.play().catch(e => console.warn('çˆ†ç‚¸éŸ³æ•ˆå¤±è´¥', e));
                    });
                    
                    boomClone.addEventListener('ended', () => boomClone.remove());
                    setTimeout(() => boomClone.remove(), 10000);
                }, 1500);
            }

            function explode(centerX, centerY) {
                const particleCount = 120;
                for (let i = 0; i < particleCount; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = 80 + Math.random() * 200;
                    const tx = Math.cos(angle) * velocity * (0.5 + Math.random() * 0.5);
                    const ty = Math.sin(angle) * velocity * (0.5 + Math.random() * 0.5);

                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    particle.style.left = centerX + 'px';
                    particle.style.top = centerY + 'px';
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.setProperty('--tx', tx + 'px');
                    particle.style.setProperty('--ty', ty + 'px');
                    const size = 3 + Math.floor(Math.random() * 4);
                    particle.style.width = size + 'px';
                    particle.style.height = size + 'px';
                    
                    document.body.appendChild(particle);

                    setTimeout(() => {
                        if (particle.parentNode) particle.remove();
                    }, 1500);
                }
            }

            function createBubbles() {
                const positions = [
                    {tx: -220, ty: -150},
                    {tx: 220, ty: -150},
                    {tx: 0, ty: -250},
                    {tx: -180, ty: 150},
                    {tx: 180, ty: 150},
                    {tx: 0, ty: 220}
                ];

                messages.forEach((msg, index) => {
                    const bubble = document.createElement('div');
                    bubble.classList.add('bubble');
                    bubble.textContent = msg;
                    bubble.style.left = '50%';
                    bubble.style.top = '50%';
                    const pos = positions[index % positions.length];
                    bubble.style.setProperty('--tx', pos.tx + 'px');
                    bubble.style.setProperty('--ty', pos.ty + 'px');
                    bubble.style.animationDelay = (index * 0.4) + 's';
                    document.body.appendChild(bubble);

                    setTimeout(() => {
                        if (bubble.parentNode) bubble.remove();
                    }, 10000);
                });
            }

            // é¡µé¢å…³é—­å‰é‡Šæ”¾ä¸´æ—¶URL
            window.addEventListener('beforeunload', function() {
                if (musicUrl) {
                    URL.revokeObjectURL(musicUrl);
                }
            });
        })();
    </script>
</body>
</html>